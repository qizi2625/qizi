ç¬¬å››å¤©ï¼šæˆ¿æºæ¨¡å—å¼€å‘ ğŸ 
æ­å–œè¿›å…¥ç¬¬å››å¤©ï¼ä»Šå¤©æˆ‘ä»¬è¦å®ç°æˆ¿æºçš„æ ¸å¿ƒåŠŸèƒ½ï¼š

ä»Šæ—¥ä»»åŠ¡æ¸…å•
æ­¥éª¤	ä»»åŠ¡	è¯´æ˜
1	åˆ›å»ºæˆ¿æºå®ä½“ç±»	House.java, HouseImage.java
2	åˆ›å»ºæˆ¿æº DTO	HousePublishDTO, HouseVO
3	åˆ›å»ºæˆ¿æº Mapper	HouseMapper, HouseImageMapper
4	åˆ›å»ºæˆ¿æº Service	å‘å¸ƒã€æŸ¥è¯¢ã€è¯¦æƒ…
5	åˆ›å»ºæˆ¿æº Controller	æ¥å£å®ç°
6	æ·»åŠ æƒé™æ§åˆ¶	åªæœ‰æˆ¿ä¸œèƒ½å‘å¸ƒ
7	æµ‹è¯•æ‰€æœ‰æ¥å£	ç”¨ REST Client
ä¸€ã€åˆ›å»ºå®ä½“ç±»
1.1 House.java
åœ¨ entity åŒ…ä¸‹åˆ›å»ºï¼š

java
package com.example.houserentalsystem.entity;

import lombok.Data;
import java.math.BigDecimal;
import java.time.LocalDateTime;

@Data
public class House {
    private Long id;
    private String title;
    private String description;
    private BigDecimal price;
    private BigDecimal area;
    private Integer bedroomCount;
    private Integer livingRoomCount;
    private Integer bathroomCount;
    private String floor;
    private String propertyType;
    private String decoration;
    private String orientation;
    private String province;
    private String city;
    private String district;
    private String address;
    private Long landlordId;
    private Integer status;  // 0-å¾…å®¡æ ¸ï¼Œ1-å·²ä¸Šæ¶ï¼Œ2-å·²ä¸‹æ¶ï¼Œ3-å·²å‡ºç§Ÿ
    private Integer viewCount;
    private Integer favoriteCount;
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
}
1.2 HouseImage.java
java
package com.example.houserentalsystem.entity;

import lombok.Data;
import java.time.LocalDateTime;

@Data
public class HouseImage {
    private Long id;
    private Long houseId;
    private String imageUrl;
    private Integer sort;
    private Integer type;  // 1-å°é¢å›¾ï¼Œ2-æ™®é€šå›¾
    private LocalDateTime createTime;
}
äºŒã€åˆ›å»º DTO ç±»
2.1 HousePublishDTO.javaï¼ˆå‘å¸ƒæˆ¿æºè¯·æ±‚ï¼‰
åœ¨ dto åŒ…ä¸‹åˆ›å»ºï¼š

java
package com.example.houserentalsystem.dto;

import lombok.Data;
import java.math.BigDecimal;
import java.util.List;

@Data
public class HousePublishDTO {
    private String title;
    private String description;
    private BigDecimal price;
    private BigDecimal area;
    private Integer bedroomCount;
    private Integer livingRoomCount;
    private Integer bathroomCount;
    private String floor;
    private String propertyType;
    private String decoration;
    private String orientation;
    private String province;
    private String city;
    private String district;
    private String address;
    private List<String> imageUrls;  // å›¾ç‰‡URLåˆ—è¡¨
}
2.2 HouseVO.javaï¼ˆè¿”å›ç»™å‰ç«¯çš„æˆ¿æºè§†å›¾ï¼‰
java
package com.example.houserentalsystem.vo;

import lombok.Data;
import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.List;

@Data
public class HouseVO {
    private Long id;
    private String title;
    private String description;
    private BigDecimal price;
    private BigDecimal area;
    private Integer bedroomCount;
    private Integer livingRoomCount;
    private Integer bathroomCount;
    private String floor;
    private String propertyType;
    private String decoration;
    private String orientation;
    private String province;
    private String city;
    private String district;
    private String address;
    private Long landlordId;
    private String landlordName;  // æˆ¿ä¸œå§“å
    private String landlordPhone;  // æˆ¿ä¸œç”µè¯
    private Integer status;
    private Integer viewCount;
    private Integer favoriteCount;
    private LocalDateTime createTime;
    private List<String> imageUrls;  // å›¾ç‰‡åˆ—è¡¨
    private String coverImage;  // å°é¢å›¾
}
2.3 HouseQueryDTO.javaï¼ˆæŸ¥è¯¢å‚æ•°ï¼‰
java
package com.example.houserentalsystem.dto;

import lombok.Data;
import java.math.BigDecimal;

@Data
public class HouseQueryDTO {
    private String keyword;      // å…³é”®è¯æœç´¢
    private String city;         // åŸå¸‚
    private String district;     // åŒºåŸŸ
    private BigDecimal minPrice; // æœ€ä½ä»·æ ¼
    private BigDecimal maxPrice; // æœ€é«˜ä»·æ ¼
    private Integer bedroomCount;// å§å®¤æ•°é‡
    private String orientation;  // æœå‘
    private String decoration;   // è£…ä¿®
    private Integer page = 1;     // é¡µç 
    private Integer size = 10;    // æ¯é¡µå¤§å°
    private String sortBy = "create_time";  // æ’åºå­—æ®µ
    private String sortOrder = "desc";      // æ’åºæ–¹å‘
}
ä¸‰ã€åˆ›å»º Mapper æ¥å£å’Œ XML
3.1 HouseMapper.java
åœ¨ mapper åŒ…ä¸‹åˆ›å»ºï¼š

java
package com.example.houserentalsystem.mapper;

import com.example.houserentalsystem.entity.House;
import com.example.houserentalsystem.dto.HouseQueryDTO;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

@Mapper
public interface HouseMapper {
    
    // æ’å…¥æˆ¿æº
    int insert(House house);
    
    // æ ¹æ®IDæŸ¥è¯¢
    House findById(@Param("id") Long id);
    
    // æŸ¥è¯¢æˆ¿ä¸œçš„æˆ¿æºåˆ—è¡¨
    List<House> findByLandlordId(@Param("landlordId") Long landlordId);
    
    // åˆ†é¡µæŸ¥è¯¢æˆ¿æºï¼ˆå¸¦æ¡ä»¶ï¼‰
    List<House> pageQuery(@Param("query") HouseQueryDTO query);
    
    // æŸ¥è¯¢æ€»æ•°ï¼ˆç”¨äºåˆ†é¡µï¼‰
    Long countQuery(@Param("query") HouseQueryDTO query);
    
    // æ›´æ–°æˆ¿æº
    int update(House house);
    
    // åˆ é™¤æˆ¿æº
    int deleteById(@Param("id") Long id);
    
    // æ›´æ–°æˆ¿æºçŠ¶æ€
    int updateStatus(@Param("id") Long id, @Param("status") Integer status);
    
    // å¢åŠ æµè§ˆæ¬¡æ•°
    int incrementViewCount(@Param("id") Long id);
    
    // å¢åŠ æ”¶è—æ¬¡æ•°
    int incrementFavoriteCount(@Param("id") Long id);
}
3.2 HouseImageMapper.java
java
package com.example.houserentalsystem.mapper;

import com.example.houserentalsystem.entity.HouseImage;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

@Mapper
public interface HouseImageMapper {
    
    // æ‰¹é‡æ’å…¥å›¾ç‰‡
    int insertBatch(@Param("list") List<HouseImage> images);
    
    // æ ¹æ®æˆ¿æºIDæŸ¥è¯¢å›¾ç‰‡
    List<HouseImage> findByHouseId(@Param("houseId") Long houseId);
    
    // åˆ é™¤æˆ¿æºçš„æ‰€æœ‰å›¾ç‰‡
    int deleteByHouseId(@Param("houseId") Long houseId);
    
    // è·å–æˆ¿æºå°é¢å›¾
    HouseImage findCoverByHouseId(@Param("houseId") Long houseId);
}
3.3 HouseMapper.xml
åœ¨ resources/mapper ä¸‹åˆ›å»ºï¼š

xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.houserentalsystem.mapper.HouseMapper">
    
    <resultMap id="BaseResultMap" type="com.example.houserentalsystem.entity.House">
        <id column="id" property="id"/>
        <result column="title" property="title"/>
        <result column="description" property="description"/>
        <result column="price" property="price"/>
        <result column="area" property="area"/>
        <result column="bedroom_count" property="bedroomCount"/>
        <result column="living_room_count" property="livingRoomCount"/>
        <result column="bathroom_count" property="bathroomCount"/>
        <result column="floor" property="floor"/>
        <result column="property_type" property="propertyType"/>
        <result column="decoration" property="decoration"/>
        <result column="orientation" property="orientation"/>
        <result column="province" property="province"/>
        <result column="city" property="city"/>
        <result column="district" property="district"/>
        <result column="address" property="address"/>
        <result column="landlord_id" property="landlordId"/>
        <result column="status" property="status"/>
        <result column="view_count" property="viewCount"/>
        <result column="favorite_count" property="favoriteCount"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>
    
    <sql id="Base_Column_List">
        id, title, description, price, area, bedroom_count, living_room_count,
        bathroom_count, floor, property_type, decoration, orientation,
        province, city, district, address, landlord_id, status,
        view_count, favorite_count, create_time, update_time
    </sql>
    
    <insert id="insert" parameterType="com.example.houserentalsystem.entity.House" 
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO house (
            title, description, price, area, bedroom_count, living_room_count,
            bathroom_count, floor, property_type, decoration, orientation,
            province, city, district, address, landlord_id, status
        ) VALUES (
            #{title}, #{description}, #{price}, #{area}, #{bedroomCount}, #{livingRoomCount},
            #{bathroomCount}, #{floor}, #{propertyType}, #{decoration}, #{orientation},
            #{province}, #{city}, #{district}, #{address}, #{landlordId}, #{status}
        )
    </insert>
    
    <select id="findById" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM house
        WHERE id = #{id}
    </select>
    
    <select id="findByLandlordId" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM house
        WHERE landlord_id = #{landlordId}
        ORDER BY create_time DESC
    </select>
    
    <select id="pageQuery" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM house
        <where>
            <if test="query.keyword != null and query.keyword != ''">
                AND (title LIKE CONCAT('%', #{query.keyword}, '%')
                OR description LIKE CONCAT('%', #{query.keyword}, '%'))
            </if>
            <if test="query.city != null and query.city != ''">
                AND city = #{query.city}
            </if>
            <if test="query.district != null and query.district != ''">
                AND district = #{query.district}
            </if>
            <if test="query.minPrice != null">
                AND price >= #{query.minPrice}
            </if>
            <if test="query.maxPrice != null">
                AND price &lt;= #{query.maxPrice}
            </if>
            <if test="query.bedroomCount != null">
                AND bedroom_count = #{query.bedroomCount}
            </if>
            <if test="query.orientation != null and query.orientation != ''">
                AND orientation = #{query.orientation}
            </if>
            <if test="query.decoration != null and query.decoration != ''">
                AND decoration = #{query.decoration}
            </if>
            AND status = 1  <!-- åªæŸ¥è¯¢å·²ä¸Šæ¶çš„ -->
        </where>
        ORDER BY 
        <choose>
            <when test="query.sortBy == 'price'">
                price ${query.sortOrder}
            </when>
            <when test="query.sortBy == 'create_time'">
                create_time ${query.sortOrder}
            </when>
            <otherwise>
                create_time DESC
            </otherwise>
        </choose>
        LIMIT #{query.size} OFFSET #{query.offset}
    </select>
    
    <select id="countQuery" resultType="java.lang.Long">
        SELECT COUNT(*)
        FROM house
        <where>
            <if test="query.keyword != null and query.keyword != ''">
                AND (title LIKE CONCAT('%', #{query.keyword}, '%')
                OR description LIKE CONCAT('%', #{query.keyword}, '%'))
            </if>
            <if test="query.city != null and query.city != ''">
                AND city = #{query.city}
            </if>
            <if test="query.district != null and query.district != ''">
                AND district = #{query.district}
            </if>
            <if test="query.minPrice != null">
                AND price >= #{query.minPrice}
            </if>
            <if test="query.maxPrice != null">
                AND price &lt;= #{query.maxPrice}
            </if>
            <if test="query.bedroomCount != null">
                AND bedroom_count = #{query.bedroomCount}
            </if>
            AND status = 1
        </where>
    </select>
    
    <update id="update">
        UPDATE house
        <set>
            <if test="title != null">title = #{title},</if>
            <if test="description != null">description = #{description},</if>
            <if test="price != null">price = #{price},</if>
            <if test="area != null">area = #{area},</if>
            <if test="status != null">status = #{status},</if>
        </set>
        WHERE id = #{id}
    </update>
    
    <update id="updateStatus">
        UPDATE house SET status = #{status} WHERE id = #{id}
    </update>
    
    <update id="incrementViewCount">
        UPDATE house SET view_count = view_count + 1 WHERE id = #{id}
    </update>
    
    <update id="incrementFavoriteCount">
        UPDATE house SET favorite_count = favorite_count + 1 WHERE id = #{id}
    </update>
    
    <delete id="deleteById">
        DELETE FROM house WHERE id = #{id}
    </delete>
</mapper>
3.4 HouseImageMapper.xml
xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.houserentalsystem.mapper.HouseImageMapper">
    
    <resultMap id="BaseResultMap" type="com.example.houserentalsystem.entity.HouseImage">
        <id column="id" property="id"/>
        <result column="house_id" property="houseId"/>
        <result column="image_url" property="imageUrl"/>
        <result column="sort" property="sort"/>
        <result column="type" property="type"/>
        <result column="create_time" property="createTime"/>
    </resultMap>
    
    <insert id="insertBatch">
        INSERT INTO house_image (house_id, image_url, sort, type) VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.houseId}, #{item.imageUrl}, #{item.sort}, #{item.type})
        </foreach>
    </insert>
    
    <select id="findByHouseId" resultMap="BaseResultMap">
        SELECT id, house_id, image_url, sort, type, create_time
        FROM house_image
        WHERE house_id = #{houseId}
        ORDER BY sort ASC
    </select>
    
    <select id="findCoverByHouseId" resultMap="BaseResultMap">
        SELECT id, house_id, image_url, sort, type, create_time
        FROM house_image
        WHERE house_id = #{houseId} AND type = 1
        LIMIT 1
    </select>
    
    <delete id="deleteByHouseId">
        DELETE FROM house_image WHERE house_id = #{houseId}
    </delete>
</mapper>
å››ã€åˆ›å»º Service å±‚
4.1 HouseService.java
java
package com.example.houserentalsystem.service;

import com.example.houserentalsystem.dto.HousePublishDTO;
import com.example.houserentalsystem.dto.HouseQueryDTO;
import com.example.houserentalsystem.entity.House;
import com.example.houserentalsystem.vo.HouseVO;
import java.util.List;
import java.util.Map;

public interface HouseService {
    
    // å‘å¸ƒæˆ¿æº
    HouseVO publish(Long landlordId, HousePublishDTO publishDTO);
    
    // æ ¹æ®IDæŸ¥è¯¢æˆ¿æºè¯¦æƒ…
    HouseVO getHouseDetail(Long id);
    
    // åˆ†é¡µæŸ¥è¯¢æˆ¿æº
    Map<String, Object> pageQuery(HouseQueryDTO queryDTO);
    
    // æŸ¥è¯¢æˆ¿ä¸œçš„æˆ¿æºåˆ—è¡¨
    List<HouseVO> getLandlordHouses(Long landlordId);
    
    // æ›´æ–°æˆ¿æº
    HouseVO updateHouse(Long id, Long landlordId, HousePublishDTO updateDTO);
    
    // åˆ é™¤æˆ¿æº
    void deleteHouse(Long id, Long landlordId);
    
    // ä¸Šæ¶/ä¸‹æ¶
    void updateStatus(Long id, Long landlordId, Integer status);
}
4.2 HouseServiceImpl.java
java
package com.example.houserentalsystem.service.impl;

import com.example.houserentalsystem.common.BusinessException;
import com.example.houserentalsystem.dto.HousePublishDTO;
import com.example.houserentalsystem.dto.HouseQueryDTO;
import com.example.houserentalsystem.entity.House;
import com.example.houserentalsystem.entity.HouseImage;
import com.example.houserentalsystem.entity.User;
import com.example.houserentalsystem.mapper.HouseMapper;
import com.example.houserentalsystem.mapper.HouseImageMapper;
import com.example.houserentalsystem.mapper.UserMapper;
import com.example.houserentalsystem.service.HouseService;
import com.example.houserentalsystem.vo.HouseVO;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

@Service
public class HouseServiceImpl implements HouseService {

    @Autowired
    private HouseMapper houseMapper;

    @Autowired
    private HouseImageMapper houseImageMapper;

    @Autowired
    private UserMapper userMapper;

    @Override
    @Transactional
    public HouseVO publish(Long landlordId, HousePublishDTO publishDTO) {
        // 1. æ£€æŸ¥æˆ¿ä¸œæ˜¯å¦å­˜åœ¨
        User landlord = userMapper.findById(landlordId);
        if (landlord == null || landlord.getRoleId() != 2) {
            throw new BusinessException("åªæœ‰æˆ¿ä¸œæ‰èƒ½å‘å¸ƒæˆ¿æº");
        }

        // 2. åˆ›å»ºæˆ¿æº
        House house = new House();
        BeanUtils.copyProperties(publishDTO, house);
        house.setLandlordId(landlordId);
        house.setStatus(0); // å¾…å®¡æ ¸
        house.setViewCount(0);
        house.setFavoriteCount(0);

        houseMapper.insert(house);

        // 3. ä¿å­˜å›¾ç‰‡
        if (publishDTO.getImageUrls() != null && !publishDTO.getImageUrls().isEmpty()) {
            List<HouseImage> images = new ArrayList<>();
            for (int i = 0; i < publishDTO.getImageUrls().size(); i++) {
                HouseImage image = new HouseImage();
                image.setHouseId(house.getId());
                image.setImageUrl(publishDTO.getImageUrls().get(i));
                image.setSort(i);
                image.setType(i == 0 ? 1 : 2); // ç¬¬ä¸€å¼ è®¾ä¸ºå°é¢
                images.add(image);
            }
            houseImageMapper.insertBatch(images);
        }

        return convertToVO(house);
    }

    @Override
    public HouseVO getHouseDetail(Long id) {
        // 1. æŸ¥è¯¢æˆ¿æº
        House house = houseMapper.findById(id);
        if (house == null) {
            throw new BusinessException("æˆ¿æºä¸å­˜åœ¨");
        }

        // 2. å¢åŠ æµè§ˆæ¬¡æ•°
        houseMapper.incrementViewCount(id);

        return convertToVO(house);
    }

    @Override
    public Map<String, Object> pageQuery(HouseQueryDTO queryDTO) {
        // è®¡ç®—åˆ†é¡µåç§»é‡
        int offset = (queryDTO.getPage() - 1) * queryDTO.getSize();
        
        // ç”±äºMyBatis XMLä¸­ç›´æ¥ç”¨#{query.xxx}ï¼Œéœ€è¦è®¾ç½®offset
        // è¿™é‡Œæˆ‘ä»¬ç®€å•å¤„ç†ï¼Œç›´æ¥ç”¨queryDTO
        List<House> houses = houseMapper.pageQuery(queryDTO);
        Long total = houseMapper.countQuery(queryDTO);

        List<HouseVO> voList = houses.stream()
                .map(this::convertToVO)
                .collect(Collectors.toList());

        Map<String, Object> result = new HashMap<>();
        result.put("records", voList);
        result.put("total", total);
        result.put("page", queryDTO.getPage());
        result.put("size", queryDTO.getSize());
        result.put("pages", (total + queryDTO.getSize() - 1) / queryDTO.getSize());

        return result;
    }

    @Override
    public List<HouseVO> getLandlordHouses(Long landlordId) {
        List<House> houses = houseMapper.findByLandlordId(landlordId);
        return houses.stream()
                .map(this::convertToVO)
                .collect(Collectors.toList());
    }

    @Override
    @Transactional
    public HouseVO updateHouse(Long id, Long landlordId, HousePublishDTO updateDTO) {
        // 1. æ£€æŸ¥æˆ¿æºæ˜¯å¦å­˜åœ¨ä¸”å±äºè¯¥æˆ¿ä¸œ
        House house = houseMapper.findById(id);
        if (house == null) {
            throw new BusinessException("æˆ¿æºä¸å­˜åœ¨");
        }
        if (!house.getLandlordId().equals(landlordId)) {
            throw new BusinessException("æ— æƒä¿®æ”¹æ­¤æˆ¿æº");
        }

        // 2. æ›´æ–°æˆ¿æºä¿¡æ¯
        BeanUtils.copyProperties(updateDTO, house);
        house.setId(id);
        houseMapper.update(house);

        // 3. æ›´æ–°å›¾ç‰‡ï¼ˆå…ˆåˆ é™¤æ—§å›¾ï¼Œå†æ·»åŠ æ–°å›¾ï¼‰
        if (updateDTO.getImageUrls() != null && !updateDTO.getImageUrls().isEmpty()) {
            houseImageMapper.deleteByHouseId(id);
            
            List<HouseImage> images = new ArrayList<>();
            for (int i = 0; i < updateDTO.getImageUrls().size(); i++) {
                HouseImage image = new HouseImage();
                image.setHouseId(id);
                image.setImageUrl(updateDTO.getImageUrls().get(i));
                image.setSort(i);
                image.setType(i == 0 ? 1 : 2);
                images.add(image);
            }
            houseImageMapper.insertBatch(images);
        }

        return convertToVO(house);
    }

    @Override
    @Transactional
    public void deleteHouse(Long id, Long landlordId) {
        House house = houseMapper.findById(id);
        if (house == null) {
            throw new BusinessException("æˆ¿æºä¸å­˜åœ¨");
        }
        if (!house.getLandlordId().equals(landlordId)) {
            throw new BusinessException("æ— æƒåˆ é™¤æ­¤æˆ¿æº");
        }

        // åˆ é™¤æˆ¿æºï¼ˆç‰©ç†åˆ é™¤ï¼‰
        houseMapper.deleteById(id);
        // åˆ é™¤å…³è”å›¾ç‰‡
        houseImageMapper.deleteByHouseId(id);
    }

    @Override
    public void updateStatus(Long id, Long landlordId, Integer status) {
        House house = houseMapper.findById(id);
        if (house == null) {
            throw new BusinessException("æˆ¿æºä¸å­˜åœ¨");
        }
        if (!house.getLandlordId().equals(landlordId)) {
            throw new BusinessException("æ— æƒæ“ä½œæ­¤æˆ¿æº");
        }

        houseMapper.updateStatus(id, status);
    }

    /**
     * å°†Houseå®ä½“è½¬æ¢ä¸ºVOï¼ˆåŒ…å«å›¾ç‰‡å’Œæˆ¿ä¸œä¿¡æ¯ï¼‰
     */
    private HouseVO convertToVO(House house) {
        HouseVO vo = new HouseVO();
        BeanUtils.copyProperties(house, vo);

        // 1. æŸ¥è¯¢æˆ¿æºå›¾ç‰‡
        List<HouseImage> images = houseImageMapper.findByHouseId(house.getId());
        List<String> imageUrls = images.stream()
                .map(HouseImage::getImageUrl)
                .collect(Collectors.toList());
        vo.setImageUrls(imageUrls);

        // 2. è®¾ç½®å°é¢å›¾
        images.stream()
                .filter(img -> img.getType() == 1)
                .findFirst()
                .ifPresent(img -> vo.setCoverImage(img.getImageUrl()));

        // 3. æŸ¥è¯¢æˆ¿ä¸œä¿¡æ¯
        User landlord = userMapper.findById(house.getLandlordId());
        if (landlord != null) {
            vo.setLandlordName(landlord.getRealName());
            vo.setLandlordPhone(landlord.getPhone());
        }

        return vo;
    }
}
äº”ã€åˆ›å»º Controller
åœ¨ controller åŒ…ä¸‹åˆ›å»º HouseController.javaï¼š

java
package com.example.houserentalsystem.controller;

import com.example.houserentalsystem.annotation.RequireToken;
import com.example.houserentalsystem.common.BusinessException;
import com.example.houserentalsystem.common.Result;
import com.example.houserentalsystem.dto.HousePublishDTO;
import com.example.houserentalsystem.dto.HouseQueryDTO;
import com.example.houserentalsystem.entity.User;
import com.example.houserentalsystem.service.HouseService;
import com.example.houserentalsystem.service.UserService;
import com.example.houserentalsystem.vo.HouseVO;
import jakarta.servlet.http.HttpServletRequest;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api/house")
public class HouseController {

    @Autowired
    private HouseService houseService;

    @Autowired
    private UserService userService;

    /**
     * å‘å¸ƒæˆ¿æºï¼ˆéœ€è¦æˆ¿ä¸œæƒé™ï¼‰
     */
    @PostMapping("/publish")
    @RequireToken
    public Result<HouseVO> publish(HttpServletRequest request, @RequestBody HousePublishDTO publishDTO) {
        Long userId = (Long) request.getAttribute("userId");
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæˆ¿ä¸œ
        User user = userService.getById(userId);
        if (user.getRoleId() != 2) {
            throw new BusinessException("åªæœ‰æˆ¿ä¸œæ‰èƒ½å‘å¸ƒæˆ¿æº");
        }

        HouseVO houseVO = houseService.publish(userId, publishDTO);
        return Result.success("å‘å¸ƒæˆåŠŸ", houseVO);
    }

    /**
     * è·å–æˆ¿æºè¯¦æƒ…
     */
    @GetMapping("/detail/{id}")
    public Result<HouseVO> getDetail(@PathVariable Long id) {
        HouseVO houseVO = houseService.getHouseDetail(id);
        return Result.success(houseVO);
    }

    /**
     * åˆ†é¡µæŸ¥è¯¢æˆ¿æº
     */
    @GetMapping("/list")
    public Result<Map<String, Object>> list(HouseQueryDTO queryDTO) {
        Map<String, Object> pageResult = houseService.pageQuery(queryDTO);
        return Result.success(pageResult);
    }

    /**
     * è·å–å½“å‰æˆ¿ä¸œçš„æˆ¿æºåˆ—è¡¨
     */
    @GetMapping("/my-houses")
    @RequireToken
    public Result<List<HouseVO>> getMyHouses(HttpServletRequest request) {
        Long userId = (Long) request.getAttribute("userId");
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæˆ¿ä¸œ
        User user = userService.getById(userId);
        if (user.getRoleId() != 2) {
            throw new BusinessException("åªæœ‰æˆ¿ä¸œæ‰èƒ½æŸ¥çœ‹è‡ªå·±çš„æˆ¿æº");
        }

        List<HouseVO> houses = houseService.getLandlordHouses(userId);
        return Result.success(houses);
    }

    /**
     * æ›´æ–°æˆ¿æº
     */
    @PutMapping("/update/{id}")
    @RequireToken
    public Result<HouseVO> update(HttpServletRequest request, 
                                  @PathVariable Long id, 
                                  @RequestBody HousePublishDTO updateDTO) {
        Long userId = (Long) request.getAttribute("userId");
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæˆ¿ä¸œ
        User user = userService.getById(userId);
        if (user.getRoleId() != 2) {
            throw new BusinessException("åªæœ‰æˆ¿ä¸œæ‰èƒ½ä¿®æ”¹æˆ¿æº");
        }

        HouseVO houseVO = houseService.updateHouse(id, userId, updateDTO);
        return Result.success("æ›´æ–°æˆåŠŸ", houseVO);
    }

    /**
     * åˆ é™¤æˆ¿æº
     */
    @DeleteMapping("/delete/{id}")
    @RequireToken
    public Result<String> delete(HttpServletRequest request, @PathVariable Long id) {
        Long userId = (Long) request.getAttribute("userId");
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæˆ¿ä¸œ
        User user = userService.getById(userId);
        if (user.getRoleId() != 2) {
            throw new BusinessException("åªæœ‰æˆ¿ä¸œæ‰èƒ½åˆ é™¤æˆ¿æº");
        }

        houseService.deleteHouse(id, userId);
        return Result.success("åˆ é™¤æˆåŠŸ");
    }

    /**
     * ä¸Šæ¶æˆ¿æº
     */
    @PutMapping("/online/{id}")
    @RequireToken
    public Result<String> online(HttpServletRequest request, @PathVariable Long id) {
        Long userId = (Long) request.getAttribute("userId");
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæˆ¿ä¸œ
        User user = userService.getById(userId);
        if (user.getRoleId() != 2) {
            throw new BusinessException("åªæœ‰æˆ¿ä¸œæ‰èƒ½æ“ä½œæˆ¿æº");
        }

        houseService.updateStatus(id, userId, 1);
        return Result.success("ä¸Šæ¶æˆåŠŸ");
    }

    /**
     * ä¸‹æ¶æˆ¿æº
     */
    @PutMapping("/offline/{id}")
    @RequireToken
    public Result<String> offline(HttpServletRequest request, @PathVariable Long id) {
        Long userId = (Long) request.getAttribute("userId");
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºæˆ¿ä¸œ
        User user = userService.getById(userId);
        if (user.getRoleId() != 2) {
            throw new BusinessException("åªæœ‰æˆ¿ä¸œæ‰èƒ½æ“ä½œæˆ¿æº");
        }

        houseService.updateStatus(id, userId, 2);
        return Result.success("ä¸‹æ¶æˆåŠŸ");
    }
}
å…­ã€åˆ›å»ºæµ‹è¯•æ–‡ä»¶ test_house.http
http
### åŸºç¡€å˜é‡
@baseUrl = http://localhost:8080

### 1. ç™»å½•è·å–tokenï¼ˆç”¨æˆ¿ä¸œè´¦å·ï¼‰
# @name login
POST {{baseUrl}}/api/user/login?username=landlord1&password=123456

### 2. ä¿å­˜token
@authToken = {{login.response.body.data.token}}

### 3. å‘å¸ƒæˆ¿æº
POST {{baseUrl}}/api/house/publish
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
    "title": "æœ›äº¬å—åœ°é“ç«™ç²¾è£…ä¸€å±…",
    "description": "ä¸´è¿‘åœ°é“ï¼Œæ­¥è¡Œ5åˆ†é’Ÿï¼Œç²¾è£…ä¿®ï¼Œå®¶å…·é½å…¨",
    "price": 4800.00,
    "area": 42.5,
    "bedroomCount": 1,
    "livingRoomCount": 1,
    "bathroomCount": 1,
    "floor": "15/25",
    "propertyType": "å…¬å¯“",
    "decoration": "ç²¾è£…",
    "orientation": "å—",
    "province": "åŒ—äº¬å¸‚",
    "city": "åŒ—äº¬å¸‚",
    "district": "æœé˜³åŒº",
    "address": "æœ›äº¬è¡—10å·é™¢3å·æ¥¼1502",
    "imageUrls": [
        "https://example.com/images/house1_cover.jpg",
        "https://example.com/images/house1_1.jpg",
        "https://example.com/images/house1_2.jpg"
    ]
}

### 4. æŸ¥è¯¢æˆ¿æºåˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
GET {{baseUrl}}/api/house/list?city=åŒ—äº¬å¸‚&district=æœé˜³åŒº&page=1&size=10

### 5. æŸ¥è¯¢æˆ¿æºè¯¦æƒ…ï¼ˆæ›¿æ¢ä¸ºå®é™…IDï¼‰
GET {{baseUrl}}/api/house/detail/1

### 6. æŸ¥è¯¢å½“å‰æˆ¿ä¸œçš„æˆ¿æº
GET {{baseUrl}}/api/house/my-houses
Authorization: Bearer {{authToken}}

### 7. æ›´æ–°æˆ¿æºï¼ˆæ›¿æ¢ä¸ºå®é™…IDï¼‰
PUT {{baseUrl}}/api/house/update/1
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
    "title": "æœ›äº¬å—åœ°é“ç«™ç²¾è£…ä¸€å±…ï¼ˆå·²æ›´æ–°ï¼‰",
    "description": "å…¨æ–°è£…ä¿®ï¼Œé¦–æ¬¡å‡ºç§Ÿ",
    "price": 5000.00,
    "area": 42.5,
    "bedroomCount": 1,
    "livingRoomCount": 1,
    "bathroomCount": 1,
    "floor": "15/25",
    "propertyType": "å…¬å¯“",
    "decoration": "ç²¾è£…",
    "orientation": "å—",
    "province": "åŒ—äº¬å¸‚",
    "city": "åŒ—äº¬å¸‚",
    "district": "æœé˜³åŒº",
    "address": "æœ›äº¬è¡—10å·é™¢3å·æ¥¼1502",
    "imageUrls": [
        "https://example.com/images/house1_cover_new.jpg",
        "https://example.com/images/house1_1_new.jpg"
    ]
}

### 8. ä¸Šæ¶æˆ¿æº
PUT {{baseUrl}}/api/house/online/1
Authorization: Bearer {{authToken}}

### 9. ä¸‹æ¶æˆ¿æº
PUT {{baseUrl}}/api/house/offline/1
Authorization: Bearer {{authToken}}

### 10. åˆ é™¤æˆ¿æº
DELETE {{baseUrl}}/api/house/delete/1
Authorization: Bearer {{authToken}}
ä»Šæ—¥ä»»åŠ¡æ¸…å•
åˆ›å»ºå®ä½“ç±»ï¼ˆHouse, HouseImageï¼‰

åˆ›å»º DTO ç±»ï¼ˆHousePublishDTO, HouseVO, HouseQueryDTOï¼‰

åˆ›å»º Mapper æ¥å£å’Œ XML

åˆ›å»º Service å®ç°

åˆ›å»º Controller

ç”¨ REST Client æµ‹è¯•æ‰€æœ‰æ¥å£