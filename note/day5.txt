ç¬¬äº”å¤©ï¼šæ ‡ç­¾ç®¡ç†ä¸ç”¨æˆ·è¡Œä¸ºé‡‡é›† ğŸ·ï¸
æ­å–œè¿›å…¥ç¬¬äº”å¤©ï¼ä»Šå¤©æˆ‘ä»¬è¦å®ç°æ ‡ç­¾ç³»ç»Ÿå’Œç”¨æˆ·è¡Œä¸ºé‡‡é›†ï¼Œä¸ºæ™ºèƒ½æ¨èæ‰“ä¸‹åŸºç¡€ã€‚

ä»Šæ—¥ä»»åŠ¡æ¸…å•
æ­¥éª¤	ä»»åŠ¡	è¯´æ˜
1	åˆ›å»ºæ ‡ç­¾è¡¨	tag, house_tag
2	åˆ›å»ºæ ‡ç­¾å®ä½“ç±»	Tag.java
3	åˆ›å»ºæ ‡ç­¾ DTO	TagDTO, TagVO
4	åˆ›å»ºæ ‡ç­¾ Mapper	å¢åˆ æ”¹æŸ¥
5	åˆ›å»ºæ ‡ç­¾ Service	æ ‡ç­¾ç®¡ç†é€»è¾‘
6	åˆ›å»ºæ ‡ç­¾ Controller	æ ‡ç­¾ç®¡ç†æ¥å£
7	åˆ›å»ºç”¨æˆ·è¡Œä¸ºè¡¨	user_behavior, user_profile
8	å®ç°è¡Œä¸ºé‡‡é›†	æµè§ˆã€æ”¶è—ã€å’¨è¯¢
9	å®ç°ç”¨æˆ·ç”»åƒ	åå¥½æ ‡ç­¾è®¡ç®—
10	æµ‹è¯•æ‰€æœ‰æ¥å£	ç”¨ REST Client
ä¸€ã€æ•°æ®åº“è¡¨è®¾è®¡
1.1 æ ‡ç­¾ç›¸å…³è¡¨
sql
-- æ ‡ç­¾è¡¨
CREATE TABLE IF NOT EXISTS `tag` (
    `id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ ‡ç­¾ID',
    `tag_name` VARCHAR(50) NOT NULL COMMENT 'æ ‡ç­¾åç§°',
    `tag_code` VARCHAR(50) COMMENT 'æ ‡ç­¾ç¼–ç ï¼ˆå¦‚ï¼šnear_subwayï¼‰',
    `category` VARCHAR(50) COMMENT 'æ ‡ç­¾åˆ†ç±»ï¼ˆäº¤é€š/è£…ä¿®/é…å¥—ï¼‰',
    `icon` VARCHAR(200) COMMENT 'å›¾æ ‡URL',
    `sort` INT DEFAULT 0 COMMENT 'æ’åºå·',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    UNIQUE KEY `uk_tag_code` (`tag_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ ‡ç­¾è¡¨';

-- æˆ¿æºæ ‡ç­¾å…³è”è¡¨
CREATE TABLE IF NOT EXISTS `house_tag` (
    `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
    `house_id` BIGINT NOT NULL COMMENT 'æˆ¿æºID',
    `tag_id` BIGINT NOT NULL COMMENT 'æ ‡ç­¾ID',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_house_id` (`house_id`),
    KEY `idx_tag_id` (`tag_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æˆ¿æºæ ‡ç­¾å…³è”è¡¨';
1.2 ç”¨æˆ·è¡Œä¸ºç›¸å…³è¡¨
sql
-- ç”¨æˆ·è¡Œä¸ºè¡¨ï¼ˆç”¨äºæ„å»ºç”¨æˆ·ç”»åƒï¼‰
CREATE TABLE IF NOT EXISTS `user_behavior` (
    `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `house_id` BIGINT NOT NULL COMMENT 'æˆ¿æºID',
    `behavior_type` TINYINT NOT NULL COMMENT 'è¡Œä¸ºç±»å‹ï¼š1-æµè§ˆï¼Œ2-æ”¶è—ï¼Œ3-å’¨è¯¢ï¼Œ4-åˆ†äº«',
    `weight` FLOAT DEFAULT 1.0 COMMENT 'è¡Œä¸ºæƒé‡ï¼ˆæ”¶è—æ¯”æµè§ˆæƒé‡å¤§ï¼‰',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'è¡Œä¸ºæ—¶é—´',
    KEY `idx_user_id` (`user_id`),
    KEY `idx_house_id` (`house_id`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡Œä¸ºè¡¨';

-- ç”¨æˆ·ç”»åƒè¡¨ï¼ˆå­˜å‚¨ç”¨æˆ·åå¥½æ ‡ç­¾ï¼‰
CREATE TABLE IF NOT EXISTS `user_profile` (
    `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `preferred_tags` JSON COMMENT 'åå¥½æ ‡ç­¾åŠæƒé‡ï¼ˆå¦‚ï¼š{"è¿‘åœ°é“":0.8, "ç²¾è£…ä¿®":0.6}ï¼‰',
    `price_min` DECIMAL(10,2) COMMENT 'åå¥½ä»·æ ¼ä¸‹é™',
    `price_max` DECIMAL(10,2) COMMENT 'åå¥½ä»·æ ¼ä¸Šé™',
    `preferred_districts` JSON COMMENT 'åå¥½åŒºåŸŸï¼ˆå¦‚ï¼š["æœé˜³åŒº","æµ·æ·€åŒº"]ï¼‰',
    `last_update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æœ€åæ›´æ–°æ—¶é—´',
    UNIQUE KEY `uk_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ç”»åƒè¡¨';
1.3 æ’å…¥åˆå§‹æ ‡ç­¾æ•°æ®
sql
-- æ’å…¥åŸºç¡€æ ‡ç­¾
INSERT INTO `tag` (`tag_name`, `tag_code`, `category`, `sort`) VALUES 
('è¿‘åœ°é“', 'near_subway', 'äº¤é€š', 1),
('ç²¾è£…ä¿®', 'fine_decorate', 'è£…ä¿®', 2),
('æ‹åŒ…å…¥ä½', 'move_in_ready', 'é…å¥—', 3),
('æœå—', 'south_facing', 'æœå‘', 4),
('ç‹¬ç«‹å«æµ´', 'private_bath', 'é…å¥—', 5),
('å¯çŸ­ç§Ÿ', 'short_term', 'ç§ŸæœŸ', 6),
('å…ä¸­ä»‹è´¹', 'no_fee', 'è´¹ç”¨', 7),
('æ°‘æ°´æ°‘ç”µ', 'residential_utility', 'è´¹ç”¨', 8),
('æœ‰ç”µæ¢¯', 'has_elevator', 'é…å¥—', 9),
('è½¦ä½', 'parking', 'é…å¥—', 10),
('é¦–æ¬¡å‡ºç§Ÿ', 'first_rent', 'æˆ¿æº', 11),
('éšæ—¶çœ‹æˆ¿', 'available_anytime', 'æœåŠ¡', 12);

-- ä¸ºå·²æœ‰çš„æˆ¿æºæ·»åŠ æ ‡ç­¾ï¼ˆç¤ºä¾‹ï¼Œæ ¹æ®ä½ çš„å®é™…IDè°ƒæ•´ï¼‰
INSERT INTO `house_tag` (`house_id`, `tag_id`) VALUES 
(4, 1), (4, 2), (4, 3), (4, 4);  -- æˆ¿æº4ï¼šè¿‘åœ°é“ã€ç²¾è£…ä¿®ã€æ‹åŒ…å…¥ä½ã€æœå—
äºŒã€åˆ›å»ºå®ä½“ç±»
2.1 Tag.java
åœ¨ entity åŒ…ä¸‹åˆ›å»ºï¼š

java
package com.example.houserentalsystem.entity;

import lombok.Data;
import java.time.LocalDateTime;

@Data
public class Tag {
    private Long id;
    private String tagName;
    private String tagCode;
    private String category;
    private String icon;
    private Integer sort;
    private LocalDateTime createTime;
}
2.2 HouseTag.java
java
package com.example.houserentalsystem.entity;

import lombok.Data;
import java.time.LocalDateTime;

@Data
public class HouseTag {
    private Long id;
    private Long houseId;
    private Long tagId;
    private LocalDateTime createTime;
}
2.3 UserBehavior.java
java
package com.example.houserentalsystem.entity;

import lombok.Data;
import java.time.LocalDateTime;

@Data
public class UserBehavior {
    private Long id;
    private Long userId;
    private Long houseId;
    private Integer behaviorType;  // 1-æµè§ˆï¼Œ2-æ”¶è—ï¼Œ3-å’¨è¯¢ï¼Œ4-åˆ†äº«
    private Float weight;
    private LocalDateTime createTime;
}
2.4 UserProfile.java
java
package com.example.houserentalsystem.entity;

import lombok.Data;
import java.math.BigDecimal;
import java.time.LocalDateTime;

@Data
public class UserProfile {
    private Long id;
    private Long userId;
    private String preferredTags;  // JSONæ ¼å¼
    private BigDecimal priceMin;
    private BigDecimal priceMax;
    private String preferredDistricts;  // JSONæ ¼å¼
    private LocalDateTime lastUpdateTime;
}
ä¸‰ã€åˆ›å»º DTO ç±»
3.1 TagDTO.java
åœ¨ dto åŒ…ä¸‹åˆ›å»ºï¼š

java
package com.example.houserentalsystem.dto;

import lombok.Data;

@Data
public class TagDTO {
    private String tagName;
    private String tagCode;
    private String category;
    private String icon;
    private Integer sort;
}
3.2 TagVO.java
java
package com.example.houserentalsystem.vo;

import lombok.Data;
import java.time.LocalDateTime;

@Data
public class TagVO {
    private Long id;
    private String tagName;
    private String tagCode;
    private String category;
    private String icon;
    private Integer sort;
    private LocalDateTime createTime;
}
3.3 BehaviorDTO.java
java
package com.example.houserentalsystem.dto;

import lombok.Data;

@Data
public class BehaviorDTO {
    private Long houseId;
    private Integer behaviorType;  // 1-æµè§ˆï¼Œ2-æ”¶è—ï¼Œ3-å’¨è¯¢ï¼Œ4-åˆ†äº«
}
3.4 HouseTagsDTO.javaï¼ˆç”¨äºæˆ¿æºè¯¦æƒ…ä¸­æ˜¾ç¤ºæ ‡ç­¾ï¼‰
java
package com.example.houserentalsystem.dto;

import lombok.Data;
import java.util.List;

@Data
public class HouseTagsDTO {
    private Long houseId;
    private List<Long> tagIds;
}
å››ã€åˆ›å»º Mapper æ¥å£å’Œ XML
4.1 TagMapper.java
java
package com.example.houserentalsystem.mapper;

import com.example.houserentalsystem.entity.Tag;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

@Mapper
public interface TagMapper {
    
    // æ’å…¥æ ‡ç­¾
    int insert(Tag tag);
    
    // æ ¹æ®IDæŸ¥è¯¢
    Tag findById(@Param("id") Long id);
    
    // æŸ¥è¯¢æ‰€æœ‰æ ‡ç­¾
    List<Tag> findAll();
    
    // æŒ‰åˆ†ç±»æŸ¥è¯¢
    List<Tag> findByCategory(@Param("category") String category);
    
    // æ›´æ–°æ ‡ç­¾
    int update(Tag tag);
    
    // åˆ é™¤æ ‡ç­¾
    int deleteById(@Param("id") Long id);
    
    // æ ¹æ®æˆ¿æºIDæŸ¥è¯¢æ ‡ç­¾åˆ—è¡¨
    List<Tag> findByHouseId(@Param("houseId") Long houseId);
}
4.2 HouseTagMapper.java
java
package com.example.houserentalsystem.mapper;

import com.example.houserentalsystem.entity.HouseTag;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

@Mapper
public interface HouseTagMapper {
    
    // æ‰¹é‡æ·»åŠ æˆ¿æºæ ‡ç­¾
    int insertBatch(@Param("list") List<HouseTag> houseTags);
    
    // åˆ é™¤æˆ¿æºçš„æ‰€æœ‰æ ‡ç­¾
    int deleteByHouseId(@Param("houseId") Long houseId);
    
    // åˆ é™¤æŒ‡å®šçš„æˆ¿æºæ ‡ç­¾
    int deleteByHouseAndTag(@Param("houseId") Long houseId, @Param("tagId") Long tagId);
    
    // æŸ¥è¯¢æˆ¿æºçš„æ ‡ç­¾IDåˆ—è¡¨
    List<Long> findTagIdsByHouseId(@Param("houseId") Long houseId);
}
4.3 UserBehaviorMapper.java
java
package com.example.houserentalsystem.mapper;

import com.example.houserentalsystem.entity.UserBehavior;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;
import java.util.Map;

@Mapper
public interface UserBehaviorMapper {
    
    // è®°å½•ç”¨æˆ·è¡Œä¸º
    int insert(UserBehavior behavior);
    
    // æŸ¥è¯¢ç”¨æˆ·çš„è¡Œä¸ºå†å²
    List<UserBehavior> findByUserId(@Param("userId") Long userId);
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ”¶è—è¿‡æŸæˆ¿æº
    int checkFavorite(@Param("userId") Long userId, @Param("houseId") Long houseId);
    
    // å–æ¶ˆæ”¶è—ï¼ˆåˆ é™¤è¡Œä¸ºè®°å½•ï¼‰
    int deleteFavorite(@Param("userId") Long userId, @Param("houseId") Long houseId);
    
    // ç»Ÿè®¡ç”¨æˆ·çš„å„ç§è¡Œä¸ºæ¬¡æ•°
    Map<String, Object> countUserBehaviors(@Param("userId") Long userId);
    
    // è·å–ç”¨æˆ·æœ€å¸¸æµè§ˆçš„æˆ¿æºæ ‡ç­¾ï¼ˆç”¨äºç”»åƒï¼‰
    List<Map<String, Object>> getUserPreferredTags(@Param("userId") Long userId);
}
4.4 UserProfileMapper.java
java
package com.example.houserentalsystem.mapper;

import com.example.houserentalsystem.entity.UserProfile;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

@Mapper
public interface UserProfileMapper {
    
    // æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”»åƒ
    UserProfile findByUserId(@Param("userId") Long userId);
    
    // æ’å…¥æˆ–æ›´æ–°ç”»åƒ
    int insertOrUpdate(UserProfile profile);
    
    // æ›´æ–°åå¥½æ ‡ç­¾
    int updatePreferredTags(@Param("userId") Long userId, @Param("preferredTags") String preferredTags);
    
    // æ›´æ–°ä»·æ ¼åå¥½
    int updatePricePreference(@Param("userId") Long userId, 
                              @Param("priceMin") java.math.BigDecimal priceMin,
                              @Param("priceMax") java.math.BigDecimal priceMax);
    
    // æ›´æ–°åŒºåŸŸåå¥½
    int updateDistricts(@Param("userId") Long userId, @Param("preferredDistricts") String preferredDistricts);
}
4.5 TagMapper.xml
åœ¨ resources/mapper ä¸‹åˆ›å»ºï¼š

xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.houserentalsystem.mapper.TagMapper">
    
    <resultMap id="BaseResultMap" type="com.example.houserentalsystem.entity.Tag">
        <id column="id" property="id"/>
        <result column="tag_name" property="tagName"/>
        <result column="tag_code" property="tagCode"/>
        <result column="category" property="category"/>
        <result column="icon" property="icon"/>
        <result column="sort" property="sort"/>
        <result column="create_time" property="createTime"/>
    </resultMap>
    
    <sql id="Base_Column_List">
        id, tag_name, tag_code, category, icon, sort, create_time
    </sql>
    
    <insert id="insert" parameterType="com.example.houserentalsystem.entity.Tag" 
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tag (tag_name, tag_code, category, icon, sort)
        VALUES (#{tagName}, #{tagCode}, #{category}, #{icon}, #{sort})
    </insert>
    
    <select id="findById" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM tag
        WHERE id = #{id}
    </select>
    
    <select id="findAll" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM tag
        ORDER BY sort ASC, id ASC
    </select>
    
    <select id="findByCategory" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM tag
        WHERE category = #{category}
        ORDER BY sort ASC
    </select>
    
    <select id="findByHouseId" resultMap="BaseResultMap">
        SELECT t.id, t.tag_name, t.tag_code, t.category, t.icon, t.sort, t.create_time
        FROM tag t
        JOIN house_tag ht ON t.id = ht.tag_id
        WHERE ht.house_id = #{houseId}
        ORDER BY t.sort ASC
    </select>
    
    <update id="update" parameterType="com.example.houserentalsystem.entity.Tag">
        UPDATE tag
        <set>
            <if test="tagName != null">tag_name = #{tagName},</if>
            <if test="tagCode != null">tag_code = #{tagCode},</if>
            <if test="category != null">category = #{category},</if>
            <if test="icon != null">icon = #{icon},</if>
            <if test="sort != null">sort = #{sort},</if>
        </set>
        WHERE id = #{id}
    </update>
    
    <delete id="deleteById">
        DELETE FROM tag WHERE id = #{id}
    </delete>
</mapper>
4.6 HouseTagMapper.xml
xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.houserentalsystem.mapper.HouseTagMapper">
    
    <insert id="insertBatch">
        INSERT INTO house_tag (house_id, tag_id) VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.houseId}, #{item.tagId})
        </foreach>
    </insert>
    
    <delete id="deleteByHouseId">
        DELETE FROM house_tag WHERE house_id = #{houseId}
    </delete>
    
    <delete id="deleteByHouseAndTag">
        DELETE FROM house_tag 
        WHERE house_id = #{houseId} AND tag_id = #{tagId}
    </delete>
    
    <select id="findTagIdsByHouseId" resultType="java.lang.Long">
        SELECT tag_id FROM house_tag WHERE house_id = #{houseId}
    </select>
</mapper>
4.7 UserBehaviorMapper.xml
xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.houserentalsystem.mapper.UserBehaviorMapper">
    
    <resultMap id="BaseResultMap" type="com.example.houserentalsystem.entity.UserBehavior">
        <id column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="house_id" property="houseId"/>
        <result column="behavior_type" property="behaviorType"/>
        <result column="weight" property="weight"/>
        <result column="create_time" property="createTime"/>
    </resultMap>
    
    <insert id="insert" parameterType="com.example.houserentalsystem.entity.UserBehavior"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO user_behavior (user_id, house_id, behavior_type, weight)
        VALUES (#{userId}, #{houseId}, #{behaviorType}, #{weight})
    </insert>
    
    <select id="findByUserId" resultMap="BaseResultMap">
        SELECT id, user_id, house_id, behavior_type, weight, create_time
        FROM user_behavior
        WHERE user_id = #{userId}
        ORDER BY create_time DESC
    </select>
    
    <select id="checkFavorite" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM user_behavior
        WHERE user_id = #{userId} AND house_id = #{houseId} AND behavior_type = 2
    </select>
    
    <delete id="deleteFavorite">
        DELETE FROM user_behavior
        WHERE user_id = #{userId} AND house_id = #{houseId} AND behavior_type = 2
    </delete>
    
    <select id="countUserBehaviors" resultType="java.util.Map">
        SELECT 
            SUM(CASE WHEN behavior_type = 1 THEN 1 ELSE 0 END) as view_count,
            SUM(CASE WHEN behavior_type = 2 THEN 1 ELSE 0 END) as favorite_count,
            SUM(CASE WHEN behavior_type = 3 THEN 1 ELSE 0 END) as consult_count,
            SUM(CASE WHEN behavior_type = 4 THEN 1 ELSE 0 END) as share_count
        FROM user_behavior
        WHERE user_id = #{userId}
    </select>
    
    <select id="getUserPreferredTags" resultType="java.util.Map">
        SELECT 
            t.id as tag_id,
            t.tag_name,
            COUNT(*) as frequency,
            SUM(ub.weight) as total_weight
        FROM user_behavior ub
        JOIN house_tag ht ON ub.house_id = ht.house_id
        JOIN tag t ON ht.tag_id = t.id
        WHERE ub.user_id = #{userId}
        GROUP BY t.id, t.tag_name
        ORDER BY total_weight DESC, frequency DESC
        LIMIT 10
    </select>
</mapper>
4.8 UserProfileMapper.xml
xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.houserentalsystem.mapper.UserProfileMapper">
    
    <resultMap id="BaseResultMap" type="com.example.houserentalsystem.entity.UserProfile">
        <id column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="preferred_tags" property="preferredTags"/>
        <result column="price_min" property="priceMin"/>
        <result column="price_max" property="priceMax"/>
        <result column="preferred_districts" property="preferredDistricts"/>
        <result column="last_update_time" property="lastUpdateTime"/>
    </resultMap>
    
    <insert id="insertOrUpdate">
        INSERT INTO user_profile (user_id, preferred_tags, price_min, price_max, preferred_districts)
        VALUES (#{userId}, #{preferredTags}, #{priceMin}, #{priceMax}, #{preferredDistricts})
        ON DUPLICATE KEY UPDATE
            preferred_tags = VALUES(preferred_tags),
            price_min = VALUES(price_min),
            price_max = VALUES(price_max),
            preferred_districts = VALUES(preferred_districts)
    </insert>
    
    <select id="findByUserId" resultMap="BaseResultMap">
        SELECT id, user_id, preferred_tags, price_min, price_max, preferred_districts, last_update_time
        FROM user_profile
        WHERE user_id = #{userId}
    </select>
    
    <update id="updatePreferredTags">
        UPDATE user_profile
        SET preferred_tags = #{preferredTags}
        WHERE user_id = #{userId}
    </update>
    
    <update id="updatePricePreference">
        UPDATE user_profile
        SET price_min = #{priceMin}, price_max = #{priceMax}
        WHERE user_id = #{userId}
    </update>
    
    <update id="updateDistricts">
        UPDATE user_profile
        SET preferred_districts = #{preferredDistricts}
        WHERE user_id = #{userId}
    </update>
</mapper>
äº”ã€åˆ›å»º Service å±‚
5.1 TagService.java
java
package com.example.houserentalsystem.service;

import com.example.houserentalsystem.dto.TagDTO;
import com.example.houserentalsystem.vo.TagVO;

import java.util.List;
import java.util.Map;

public interface TagService {
    
    // åˆ›å»ºæ ‡ç­¾
    TagVO createTag(TagDTO tagDTO);
    
    // æ›´æ–°æ ‡ç­¾
    TagVO updateTag(Long id, TagDTO tagDTO);
    
    // åˆ é™¤æ ‡ç­¾
    void deleteTag(Long id);
    
    // æŸ¥è¯¢å•ä¸ªæ ‡ç­¾
    TagVO getTag(Long id);
    
    // æŸ¥è¯¢æ‰€æœ‰æ ‡ç­¾
    List<TagVO> getAllTags();
    
    // æŒ‰åˆ†ç±»æŸ¥è¯¢
    List<TagVO> getTagsByCategory(String category);
    
    // ç»™æˆ¿æºæ·»åŠ æ ‡ç­¾
    void addTagsToHouse(Long houseId, List<Long> tagIds);
    
    // ç§»é™¤æˆ¿æºçš„æ ‡ç­¾
    void removeTagFromHouse(Long houseId, Long tagId);
    
    // è·å–æˆ¿æºçš„æ ‡ç­¾
    List<TagVO> getHouseTags(Long houseId);
}
5.2 TagServiceImpl.java
java
package com.example.houserentalsystem.service.impl;

import com.example.houserentalsystem.common.BusinessException;
import com.example.houserentalsystem.dto.TagDTO;
import com.example.houserentalsystem.entity.HouseTag;
import com.example.houserentalsystem.entity.Tag;
import com.example.houserentalsystem.mapper.HouseMapper;
import com.example.houserentalsystem.mapper.HouseTagMapper;
import com.example.houserentalsystem.mapper.TagMapper;
import com.example.houserentalsystem.service.TagService;
import com.example.houserentalsystem.vo.TagVO;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class TagServiceImpl implements TagService {

    @Autowired
    private TagMapper tagMapper;

    @Autowired
    private HouseTagMapper houseTagMapper;

    @Autowired
    private HouseMapper houseMapper;

    @Override
    public TagVO createTag(TagDTO tagDTO) {
        Tag tag = new Tag();
        BeanUtils.copyProperties(tagDTO, tag);
        
        tagMapper.insert(tag);
        return convertToVO(tag);
    }

    @Override
    public TagVO updateTag(Long id, TagDTO tagDTO) {
        Tag tag = tagMapper.findById(id);
        if (tag == null) {
            throw new BusinessException("æ ‡ç­¾ä¸å­˜åœ¨");
        }
        
        BeanUtils.copyProperties(tagDTO, tag);
        tag.setId(id);
        
        tagMapper.update(tag);
        return convertToVO(tag);
    }

    @Override
    public void deleteTag(Long id) {
        Tag tag = tagMapper.findById(id);
        if (tag == null) {
            throw new BusinessException("æ ‡ç­¾ä¸å­˜åœ¨");
        }
        tagMapper.deleteById(id);
    }

    @Override
    public TagVO getTag(Long id) {
        Tag tag = tagMapper.findById(id);
        if (tag == null) {
            throw new BusinessException("æ ‡ç­¾ä¸å­˜åœ¨");
        }
        return convertToVO(tag);
    }

    @Override
    public List<TagVO> getAllTags() {
        List<Tag> tags = tagMapper.findAll();
        return tags.stream()
                .map(this::convertToVO)
                .collect(Collectors.toList());
    }

    @Override
    public List<TagVO> getTagsByCategory(String category) {
        List<Tag> tags = tagMapper.findByCategory(category);
        return tags.stream()
                .map(this::convertToVO)
                .collect(Collectors.toList());
    }

    @Override
    @Transactional
    public void addTagsToHouse(Long houseId, List<Long> tagIds) {
        // æ£€æŸ¥æˆ¿æºæ˜¯å¦å­˜åœ¨
        if (houseMapper.findById(houseId) == null) {
            throw new BusinessException("æˆ¿æºä¸å­˜åœ¨");
        }
        
        // å…ˆåˆ é™¤åŸæœ‰çš„æ ‡ç­¾å…³è”
        houseTagMapper.deleteByHouseId(houseId);
        
        // æ·»åŠ æ–°çš„æ ‡ç­¾å…³è”
        if (tagIds != null && !tagIds.isEmpty()) {
            List<HouseTag> houseTags = new ArrayList<>();
            for (Long tagId : tagIds) {
                // æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å­˜åœ¨
                if (tagMapper.findById(tagId) == null) {
                    throw new BusinessException("æ ‡ç­¾ID " + tagId + " ä¸å­˜åœ¨");
                }
                HouseTag houseTag = new HouseTag();
                houseTag.setHouseId(houseId);
                houseTag.setTagId(tagId);
                houseTags.add(houseTag);
            }
            houseTagMapper.insertBatch(houseTags);
        }
    }

    @Override
    public void removeTagFromHouse(Long houseId, Long tagId) {
        houseTagMapper.deleteByHouseAndTag(houseId, tagId);
    }

    @Override
    public List<TagVO> getHouseTags(Long houseId) {
        List<Tag> tags = tagMapper.findByHouseId(houseId);
        return tags.stream()
                .map(this::convertToVO)
                .collect(Collectors.toList());
    }

    private TagVO convertToVO(Tag tag) {
        TagVO vo = new TagVO();
        BeanUtils.copyProperties(tag, vo);
        return vo;
    }
}
5.3 BehaviorService.java
java
package com.example.houserentalsystem.service;

import com.example.houserentalsystem.dto.BehaviorDTO;
import com.example.houserentalsystem.vo.TagVO;

import java.util.List;
import java.util.Map;

public interface BehaviorService {
    
    // è®°å½•ç”¨æˆ·è¡Œä¸º
    void recordBehavior(Long userId, BehaviorDTO behaviorDTO);
    
    // æ”¶è—æˆ¿æº
    void favoriteHouse(Long userId, Long houseId);
    
    // å–æ¶ˆæ”¶è—
    void unfavoriteHouse(Long userId, Long houseId);
    
    // æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
    boolean checkFavorite(Long userId, Long houseId);
    
    // è·å–ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡
    Map<String, Object> getUserBehaviorStats(Long userId);
    
    // æ„å»ºç”¨æˆ·ç”»åƒ
    void buildUserProfile(Long userId);
    
    // è·å–ç”¨æˆ·åå¥½æ ‡ç­¾
    List<TagVO> getUserPreferredTags(Long userId);
    
    // è·å–ç”¨æˆ·åå¥½ä»·æ ¼åŒºé—´
    Map<String, Object> getUserPricePreference(Long userId);
}
5.4 BehaviorServiceImpl.java
java
package com.example.houserentalsystem.service.impl;

import com.example.houserentalsystem.common.BusinessException;
import com.example.houserentalsystem.dto.BehaviorDTO;
import com.example.houserentalsystem.entity.*;
import com.example.houserentalsystem.mapper.*;
import com.example.houserentalsystem.service.BehaviorService;
import com.example.houserentalsystem.vo.TagVO;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;
import java.util.*;
import java.util.stream.Collectors;

@Service
public class BehaviorServiceImpl implements BehaviorService {

    @Autowired
    private UserBehaviorMapper userBehaviorMapper;

    @Autowired
    private UserProfileMapper userProfileMapper;

    @Autowired
    private TagMapper tagMapper;

    @Autowired
    private HouseMapper houseMapper;

    @Autowired
    private ObjectMapper objectMapper;

    // è¡Œä¸ºç±»å‹å¯¹åº”çš„æƒé‡
    private static final Map<Integer, Float> BEHAVIOR_WEIGHT = Map.of(
            1, 1.0f,  // æµè§ˆ
            2, 3.0f,  // æ”¶è—
            3, 2.0f,  // å’¨è¯¢
            4, 1.5f   // åˆ†äº«
    );

    @Override
    @Transactional
    public void recordBehavior(Long userId, BehaviorDTO behaviorDTO) {
        // æ£€æŸ¥æˆ¿æºæ˜¯å¦å­˜åœ¨
        if (houseMapper.findById(behaviorDTO.getHouseId()) == null) {
            throw new BusinessException("æˆ¿æºä¸å­˜åœ¨");
        }

        // åˆ›å»ºè¡Œä¸ºè®°å½•
        UserBehavior behavior = new UserBehavior();
        behavior.setUserId(userId);
        behavior.setHouseId(behaviorDTO.getHouseId());
        behavior.setBehaviorType(behaviorDTO.getBehaviorType());
        behavior.setWeight(BEHAVIOR_WEIGHT.getOrDefault(behaviorDTO.getBehaviorType(), 1.0f));

        userBehaviorMapper.insert(behavior);

        // å¦‚æœæ˜¯æ”¶è—è¡Œä¸ºï¼Œä¸éœ€è¦è§¦å‘ç”»åƒæ›´æ–°ï¼ˆé¿å…é¢‘ç¹æ›´æ–°ï¼‰
        // å¯ä»¥åœ¨å®šæ—¶ä»»åŠ¡ä¸­æ‰¹é‡æ›´æ–°ç”»åƒ
    }

    @Override
    @Transactional
    public void favoriteHouse(Long userId, Long houseId) {
        // æ£€æŸ¥æ˜¯å¦å·²ç»æ”¶è—
        if (checkFavorite(userId, houseId)) {
            throw new BusinessException("å·²ç»æ”¶è—è¿‡è¯¥æˆ¿æº");
        }

        BehaviorDTO behaviorDTO = new BehaviorDTO();
        behaviorDTO.setHouseId(houseId);
        behaviorDTO.setBehaviorType(2); // æ”¶è—
        recordBehavior(userId, behaviorDTO);
    }

    @Override
    @Transactional
    public void unfavoriteHouse(Long userId, Long houseId) {
        userBehaviorMapper.deleteFavorite(userId, houseId);
    }

    @Override
    public boolean checkFavorite(Long userId, Long houseId) {
        return userBehaviorMapper.checkFavorite(userId, houseId) > 0;
    }

    @Override
    public Map<String, Object> getUserBehaviorStats(Long userId) {
        return userBehaviorMapper.countUserBehaviors(userId);
    }

    @Override
    @Transactional
    public void buildUserProfile(Long userId) {
        // 1. è·å–ç”¨æˆ·åå¥½æ ‡ç­¾
        List<Map<String, Object>> preferredTagsData = userBehaviorMapper.getUserPreferredTags(userId);
        
        // 2. è½¬æ¢ä¸ºæ ‡ç­¾æƒé‡Map
        Map<String, Double> tagWeights = new HashMap<>();
        for (Map<String, Object> data : preferredTagsData) {
            String tagName = (String) data.get("tag_name");
            Number totalWeight = (Number) data.get("total_weight");
            tagWeights.put(tagName, totalWeight.doubleValue());
        }

        // 3. è·å–ç”¨æˆ·æµè§ˆè¿‡çš„æˆ¿æºä»·æ ¼èŒƒå›´
        // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…å¯ä»¥ä»è¡Œä¸ºè®°å½•ä¸­ç»Ÿè®¡
        BigDecimal priceMin = null;
        BigDecimal priceMax = null;

        // 4. è·å–ç”¨æˆ·åå¥½çš„åŒºåŸŸ
        List<String> preferredDistricts = new ArrayList<>();

        // 5. ä¿å­˜æˆ–æ›´æ–°ç”¨æˆ·ç”»åƒ
        UserProfile profile = userProfileMapper.findByUserId(userId);
        if (profile == null) {
            profile = new UserProfile();
            profile.setUserId(userId);
        }

        try {
            profile.setPreferredTags(objectMapper.writeValueAsString(tagWeights));
            profile.setPriceMin(priceMin);
            profile.setPriceMax(priceMax);
            profile.setPreferredDistricts(objectMapper.writeValueAsString(preferredDistricts));
            
            userProfileMapper.insertOrUpdate(profile);
        } catch (JsonProcessingException e) {
            throw new RuntimeException("JSONå¤„ç†å¤±è´¥", e);
        }
    }

    @Override
    public List<TagVO> getUserPreferredTags(Long userId) {
        UserProfile profile = userProfileMapper.findByUserId(userId);
        if (profile == null || profile.getPreferredTags() == null) {
            return new ArrayList<>();
        }

        try {
            Map<String, Double> tagWeights = objectMapper.readValue(
                    profile.getPreferredTags(), 
                    new TypeReference<Map<String, Double>>() {}
            );
            
            // æŒ‰æƒé‡æ’åºï¼Œè¿”å›å‰10ä¸ªæ ‡ç­¾
            List<TagVO> result = new ArrayList<>();
            tagWeights.entrySet().stream()
                    .sorted(Map.Entry.<String, Double>comparingByValue().reversed())
                    .limit(10)
                    .forEach(entry -> {
                        TagVO vo = new TagVO();
                        vo.setTagName(entry.getKey());
                        // å¯ä»¥è®¾ç½®å…¶ä»–å±æ€§
                        result.add(vo);
                    });
            return result;
        } catch (JsonProcessingException e) {
            throw new RuntimeException("è§£ææ ‡ç­¾æ•°æ®å¤±è´¥", e);
        }
    }

    @Override
    public Map<String, Object> getUserPricePreference(Long userId) {
        UserProfile profile = userProfileMapper.findByUserId(userId);
        Map<String, Object> result = new HashMap<>();
        if (profile != null) {
            result.put("priceMin", profile.getPriceMin());
            result.put("priceMax", profile.getPriceMax());
        }
        return result;
    }
}
å…­ã€åˆ›å»º Controller å±‚
6.1 TagController.java
java
package com.example.houserentalsystem.controller;

import com.example.houserentalsystem.annotation.RequireToken;
import com.example.houserentalsystem.common.Result;
import com.example.houserentalsystem.dto.TagDTO;
import com.example.houserentalsystem.service.TagService;
import com.example.houserentalsystem.vo.TagVO;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/tag")
public class TagController {

    @Autowired
    private TagService tagService;

    /**
     * åˆ›å»ºæ ‡ç­¾ï¼ˆç®¡ç†å‘˜ï¼‰
     */
    @PostMapping("/create")
    @RequireToken
    public Result<TagVO> createTag(@RequestBody TagDTO tagDTO) {
        TagVO tagVO = tagService.createTag(tagDTO);
        return Result.success("åˆ›å»ºæˆåŠŸ", tagVO);
    }

    /**
     * æ›´æ–°æ ‡ç­¾ï¼ˆç®¡ç†å‘˜ï¼‰
     */
    @PutMapping("/update/{id}")
    @RequireToken
    public Result<TagVO> updateTag(@PathVariable Long id, @RequestBody TagDTO tagDTO) {
        TagVO tagVO = tagService.updateTag(id, tagDTO);
        return Result.success("æ›´æ–°æˆåŠŸ", tagVO);
    }

    /**
     * åˆ é™¤æ ‡ç­¾ï¼ˆç®¡ç†å‘˜ï¼‰
     */
    @DeleteMapping("/delete/{id}")
    @RequireToken
    public Result<String> deleteTag(@PathVariable Long id) {
        tagService.deleteTag(id);
        return Result.success("åˆ é™¤æˆåŠŸ");
    }

    /**
     * æŸ¥è¯¢æ‰€æœ‰æ ‡ç­¾
     */
    @GetMapping("/list")
    public Result<List<TagVO>> getAllTags() {
        List<TagVO> tags = tagService.getAllTags();
        return Result.success(tags);
    }

    /**
     * æŒ‰åˆ†ç±»æŸ¥è¯¢æ ‡ç­¾
     */
    @GetMapping("/category/{category}")
    public Result<List<TagVO>> getTagsByCategory(@PathVariable String category) {
        List<TagVO> tags = tagService.getTagsByCategory(category);
        return Result.success(tags);
    }

    /**
     * æŸ¥è¯¢å•ä¸ªæ ‡ç­¾
     */
    @GetMapping("/{id}")
    public Result<TagVO> getTag(@PathVariable Long id) {
        TagVO tag = tagService.getTag(id);
        return Result.success(tag);
    }

    /**
     * è·å–æˆ¿æºçš„æ ‡ç­¾
     */
    @GetMapping("/house/{houseId}")
    public Result<List<TagVO>> getHouseTags(@PathVariable Long houseId) {
        List<TagVO> tags = tagService.getHouseTags(houseId);
        return Result.success(tags);
    }
}
6.2 HouseTagController.javaï¼ˆæˆ¿æºæ ‡ç­¾ç®¡ç†ï¼‰
java
package com.example.houserentalsystem.controller;

import com.example.houserentalsystem.annotation.RequireToken;
import com.example.houserentalsystem.common.Result;
import com.example.houserentalsystem.dto.HouseTagsDTO;
import com.example.houserentalsystem.service.TagService;
import com.example.houserentalsystem.vo.TagVO;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import jakarta.servlet.http.HttpServletRequest;
import java.util.List;

@RestController
@RequestMapping("/api/house/tag")
public class HouseTagController {

    @Autowired
    private TagService tagService;

    /**
     * ç»™æˆ¿æºæ·»åŠ æ ‡ç­¾ï¼ˆæˆ¿ä¸œ/ç®¡ç†å‘˜ï¼‰
     */
    @PostMapping("/add")
    @RequireToken
    public Result<String> addTagsToHouse(@RequestBody HouseTagsDTO houseTagsDTO) {
        tagService.addTagsToHouse(houseTagsDTO.getHouseId(), houseTagsDTO.getTagIds());
        return Result.success("æ·»åŠ æˆåŠŸ");
    }

    /**
     * ç§»é™¤æˆ¿æºæ ‡ç­¾
     */
    @DeleteMapping("/remove/{houseId}/{tagId}")
    @RequireToken
    public Result<String> removeTagFromHouse(@PathVariable Long houseId, @PathVariable Long tagId) {
        tagService.removeTagFromHouse(houseId, tagId);
        return Result.success("ç§»é™¤æˆåŠŸ");
    }
}
6.3 BehaviorController.java
java
package com.example.houserentalsystem.controller;

import com.example.houserentalsystem.annotation.RequireToken;
import com.example.houserentalsystem.common.Result;
import com.example.houserentalsystem.dto.BehaviorDTO;
import com.example.houserentalsystem.service.BehaviorService;
import com.example.houserentalsystem.vo.TagVO;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import jakarta.servlet.http.HttpServletRequest;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api/behavior")
public class BehaviorController {

    @Autowired
    private BehaviorService behaviorService;

    /**
     * è®°å½•ç”¨æˆ·è¡Œä¸º
     */
    @PostMapping("/record")
    @RequireToken
    public Result<String> recordBehavior(HttpServletRequest request, @RequestBody BehaviorDTO behaviorDTO) {
        Long userId = (Long) request.getAttribute("userId");
        behaviorService.recordBehavior(userId, behaviorDTO);
        return Result.success("è®°å½•æˆåŠŸ");
    }

    /**
     * æ”¶è—æˆ¿æº
     */
    @PostMapping("/favorite/{houseId}")
    @RequireToken
    public Result<String> favoriteHouse(HttpServletRequest request, @PathVariable Long houseId) {
        Long userId = (Long) request.getAttribute("userId");
        behaviorService.favoriteHouse(userId, houseId);
        return Result.success("æ”¶è—æˆåŠŸ");
    }

    /**
     * å–æ¶ˆæ”¶è—
     */
    @DeleteMapping("/favorite/{houseId}")
    @RequireToken
    public Result<String> unfavoriteHouse(HttpServletRequest request, @PathVariable Long houseId) {
        Long userId = (Long) request.getAttribute("userId");
        behaviorService.unfavoriteHouse(userId, houseId);
        return Result.success("å–æ¶ˆæ”¶è—æˆåŠŸ");
    }

    /**
     * æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
     */
    @GetMapping("/favorite/check/{houseId}")
    @RequireToken
    public Result<Boolean> checkFavorite(HttpServletRequest request, @PathVariable Long houseId) {
        Long userId = (Long) request.getAttribute("userId");
        boolean isFavorite = behaviorService.checkFavorite(userId, houseId);
        return Result.success(isFavorite);
    }

    /**
     * è·å–ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡
     */
    @GetMapping("/stats")
    @RequireToken
    public Result<Map<String, Object>> getUserStats(HttpServletRequest request) {
        Long userId = (Long) request.getAttribute("userId");
        Map<String, Object> stats = behaviorService.getUserBehaviorStats(userId);
        return Result.success(stats);
    }

    /**
     * æ‰‹åŠ¨è§¦å‘æ„å»ºç”¨æˆ·ç”»åƒ
     */
    @PostMapping("/profile/build")
    @RequireToken
    public Result<String> buildProfile(HttpServletRequest request) {
        Long userId = (Long) request.getAttribute("userId");
        behaviorService.buildUserProfile(userId);
        return Result.success("ç”»åƒæ„å»ºæˆåŠŸ");
    }

    /**
     * è·å–ç”¨æˆ·åå¥½æ ‡ç­¾
     */
    @GetMapping("/profile/tags")
    @RequireToken
    public Result<List<TagVO>> getPreferredTags(HttpServletRequest request) {
        Long userId = (Long) request.getAttribute("userId");
        List<TagVO> tags = behaviorService.getUserPreferredTags(userId);
        return Result.success(tags);
    }

    /**
     * è·å–ç”¨æˆ·ä»·æ ¼åå¥½
     */
    @GetMapping("/profile/price")
    @RequireToken
    public Result<Map<String, Object>> getPricePreference(HttpServletRequest request) {
        Long userId = (Long) request.getAttribute("userId");
        Map<String, Object> pricePref = behaviorService.getUserPricePreference(userId);
        return Result.success(pricePref);
    }
}
6.4 ä¿®æ”¹ HouseController.javaï¼ˆæ·»åŠ æ ‡ç­¾ä¿¡æ¯ï¼‰
åœ¨ HouseVO ä¸­æ·»åŠ æ ‡ç­¾å­—æ®µï¼š

java
// åœ¨ HouseVO.java ä¸­æ·»åŠ 
private List<TagVO> tags;
åœ¨ HouseServiceImpl.java çš„ convertToVO æ–¹æ³•ä¸­æ·»åŠ ï¼š

java
// 4. æŸ¥è¯¢æˆ¿æºæ ‡ç­¾
List<Tag> tags = tagMapper.findByHouseId(house.getId());
List<TagVO> tagVOs = tags.stream()
        .map(tag -> {
            TagVO tagVO = new TagVO();
            BeanUtils.copyProperties(tag, tagVO);
            return tagVO;
        })
        .collect(Collectors.toList());
vo.setTags(tagVOs);
ä¸ƒã€åˆ›å»ºæµ‹è¯•æ–‡ä»¶ test_tag_behavior.http
http
### åŸºç¡€å˜é‡
@baseUrl = http://localhost:8080

### 1. ç™»å½•è·å–tokenï¼ˆç”¨æ–°æˆ¿ä¸œè´¦å·ï¼‰
# @name login
POST {{baseUrl}}/api/user/login?username=landlord2&password=123456

### 2. ä¿å­˜token
@authToken = {{login.response.body.data.token}}

### ==================== æ ‡ç­¾ç®¡ç†æµ‹è¯• ====================

### 3. æŸ¥è¯¢æ‰€æœ‰æ ‡ç­¾
GET {{baseUrl}}/api/tag/list

### 4. æŒ‰åˆ†ç±»æŸ¥è¯¢æ ‡ç­¾
GET {{baseUrl}}/api/tag/category/äº¤é€š

### 5. æŸ¥è¯¢æˆ¿æº4çš„æ ‡ç­¾
GET {{baseUrl}}/api/tag/house/4

### 6. ç»™æˆ¿æº4æ·»åŠ æ ‡ç­¾ï¼ˆæ·»åŠ è¿‘åœ°é“ã€ç²¾è£…ä¿®ã€æœå—ï¼‰
POST {{baseUrl}}/api/house/tag/add
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
    "houseId": 4,
    "tagIds": [1, 2, 4]
}

### 7. å†æ¬¡æŸ¥è¯¢æˆ¿æº4çš„æ ‡ç­¾
GET {{baseUrl}}/api/tag/house/4

### 8. ç§»é™¤æˆ¿æº4çš„æŸä¸ªæ ‡ç­¾ï¼ˆç§»é™¤æœå—ï¼‰
DELETE {{baseUrl}}/api/house/tag/remove/4/4
Authorization: Bearer {{authToken}}

### 9. å†æ¬¡æŸ¥è¯¢æˆ¿æº4çš„æ ‡ç­¾
GET {{baseUrl}}/api/tag/house/4

### ==================== ç”¨æˆ·è¡Œä¸ºæµ‹è¯• ====================

### 10. ç”¨ç§Ÿå®¢è´¦å·ç™»å½•
# @name tenantLogin
POST {{baseUrl}}/api/user/login?username=tenant1&password=123456

### 11. ä¿å­˜ç§Ÿå®¢token
@tenantToken = {{tenantLogin.response.body.data.token}}

### 12. è®°å½•æµè§ˆè¡Œä¸º
POST {{baseUrl}}/api/behavior/record
Authorization: Bearer {{tenantToken}}
Content-Type: application/json

{
    "houseId": 4,
    "behaviorType": 1
}

### 13. æ”¶è—æˆ¿æº4
POST {{baseUrl}}/api/behavior/favorite/4
Authorization: Bearer {{tenantToken}}

### 14. æ£€æŸ¥æ˜¯å¦æ”¶è—
GET {{baseUrl}}/api/behavior/favorite/check/4
Authorization: Bearer {{tenantToken}}

### 15. è·å–è¡Œä¸ºç»Ÿè®¡
GET {{baseUrl}}/api/behavior/stats
Authorization: Bearer {{tenantToken}}

### 16. æ„å»ºç”¨æˆ·ç”»åƒ
POST {{baseUrl}}/api/behavior/profile/build
Authorization: Bearer {{tenantToken}}

### 17. è·å–åå¥½æ ‡ç­¾
GET {{baseUrl}}/api/behavior/profile/tags
Authorization: Bearer {{tenantToken}}

### 18. è·å–ä»·æ ¼åå¥½
GET {{baseUrl}}/api/behavior/profile/price
Authorization: Bearer {{tenantToken}}

### 19. å–æ¶ˆæ”¶è—
DELETE {{baseUrl}}/api/behavior/favorite/4
Authorization: Bearer {{tenantToken}}

### 20. å†æ¬¡æ£€æŸ¥æ”¶è—
GET {{baseUrl}}/api/behavior/favorite/check/4
Authorization: Bearer {{tenantToken}}
å…«ã€ç¬¬äº”å¤©ä»»åŠ¡æ¸…å•
æ‰§è¡Œæ•°æ®åº“SQLåˆ›å»ºæ ‡ç­¾å’Œè¡Œä¸ºè¡¨

åˆ›å»ºå®ä½“ç±»ï¼ˆTag, HouseTag, UserBehavior, UserProfileï¼‰

åˆ›å»º DTO ç±»

åˆ›å»º Mapper æ¥å£å’Œ XML

åˆ›å»º TagService å®ç°

åˆ›å»º BehaviorService å®ç°

åˆ›å»º TagController

åˆ›å»º HouseTagController

åˆ›å»º BehaviorController

ä¿®æ”¹ HouseController æ·»åŠ æ ‡ç­¾ä¿¡æ¯

ç”¨ REST Client æµ‹è¯•æ‰€æœ‰æ¥å£